<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zen Manga Reader</title>
    <style>
        /* --- BASE --- */
        body, html { margin: 0; padding: 0; background-color: #000; width: 100%; height: 100%; font-family: -apple-system, sans-serif; color: white; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        /* --- VISOR --- */
        .visor { max-width: 500px; margin: 0 auto; padding-bottom: 100px; min-height: 100vh; cursor: pointer; }
        .pag { display: block; width: 100%; height: auto; margin: 0; opacity: 0; transition: opacity 0.5s ease; background-color: #0a0a0a; min-height: 400px; }
        .pag.loaded { opacity: 1; }
        
        /* --- ERROR MSG --- */
        .error-msg { color: #666; font-size: 0.8rem; text-align: center; padding: 20px; display: none; }

        /* --- UI FLOTANTE --- */
        .dynamic-dock-container { position: fixed; bottom: 30px; left: 0; width: 100%; display: flex; justify-content: center; z-index: 1000; pointer-events: none; transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); }
        .dynamic-dock-container.hidden { transform: translateY(150%); }
        .dynamic-island { pointer-events: auto; position: relative; width: auto; min-width: 120px; height: 50px; background: rgba(30, 30, 30, 0.9); backdrop-filter: blur(10px); border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.5); overflow: hidden; }
        .dynamic-island:active { transform: scale(0.95); }
        .island-progress { position: absolute; top: 0; left: 0; height: 100%; width: 0%; background: rgba(255, 255, 255, 0.15); z-index: 1; transition: width 0.1s linear; }
        .island-content { position: relative; z-index: 2; font-size: 1rem; font-weight: 600; color: #eee; }

        /* --- BOTTOM SHEET --- */
        .bottom-sheet-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; animation: fadeIn 0.3s forwards; }
        .bottom-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: #1c1c1e; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 20px; padding-bottom: 40px; box-sizing: border-box; transform: translateY(100%); animation: slideUp 0.3s forwards; display: flex; flex-direction: column; max-height: 70vh; }
        .sheet-handle { width: 40px; height: 5px; background: #444; border-radius: 10px; margin: 0 auto 20px auto; }
        .grid-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; overflow-y: auto; padding: 5px; }
        .grid-btn { aspect-ratio: 1; background: #2c2c2e; border: none; border-radius: 12px; color: #fff; font-size: 1rem; font-weight: bold; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .grid-btn.active { background: #fff; color: #000; }
        @keyframes fadeIn { to { opacity: 1; } } @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <main class="visor" id="contenedor-imagenes" onclick="toggleCinemaMode()">
        <!-- 
            AQUÍ YA NO HAY IMÁGENES MANUALES.
            El script de abajo las creará automáticamente.
        -->
        <div id="loading" style="text-align:center; padding:50px; color:#555;">Cargando Capítulo...</div>
    </main>

    <!-- UI FLOTANTE -->
    <div class="dynamic-dock-container" id="dock-container">
        <div class="dynamic-island" onclick="event.stopPropagation(); abrirSheet()">
            <div class="island-progress" id="dock-progress"></div>
            <div class="island-content"><span id="page-display">1</span></div>
        </div>
    </div>

    <!-- MENÚ -->
    <div class="bottom-sheet-overlay" id="sheet-overlay" onclick="cerrarSheet(event)">
        <div class="bottom-sheet">
            <div class="sheet-handle"></div>
            <div class="grid-container" id="grid-container"></div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const TOTAL_PAGINAS = 77;      // <--- CAMBIA ESTO SI SUBES MÁS O MENOS FOTOS
        const CARPETA_MANGA = 'manga'; // Nombre de la carpeta en GitHub
        const EXTENSION = '.webp';     // .jpg, .png o .webp (según tus archivos)
        // ---------------------

        document.addEventListener("DOMContentLoaded", () => {
            const contenedor = document.getElementById('contenedor-imagenes');
            const gridContainer = document.getElementById('grid-container');
            const loading = document.getElementById('loading');
            
            // 1. GENERADOR AUTOMÁTICO DE IMÁGENES
            loading.style.display = 'none'; // Quitar texto de carga

            for (let i = 1; i <= TOTAL_PAGINAS; i++) {
                // Crear imagen
                const img = document.createElement('img');
                img.className = 'pag';
                img.id = `img-${i}`;
                
                // RUTA INTELIGENTE: busca en carpeta "manga/1.webp"
                img.src = `${CARPETA_MANGA}/${i}${EXTENSION}`;
                
                // Lazy load para todas menos las primeras 3 (velocidad)
                if (i > 3) img.loading = "lazy";

                // Manejo de errores (si falta una imagen)
                img.onerror = function() { 
                    this.style.display='none'; 
                    console.log(`Falta la imagen ${i}`); 
                };

                img.onload = () => img.classList.add('loaded');
                
                contenedor.appendChild(img);

                // Crear botón menú
                const btn = document.createElement('button');
                btn.className = 'grid-btn';
                btn.id = `btn-${i}`;
                btn.innerText = i;
                btn.onclick = () => irAPagina(i);
                gridContainer.appendChild(btn);
            }

            // 2. INICIAR OBSERVADOR (Lógica de scroll)
            iniciarObserver();
        });

        // --- LÓGICA DE UI (IGUAL QUE ANTES) ---
        const pageDisplay = document.getElementById('page-display');
        const dockProgress = document.getElementById('dock-progress');

        function iniciarObserver() {
            const imagenes = document.querySelectorAll('.pag');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const num = parseInt(entry.target.id.split('-')[1]);
                        actualizarUI(num);
                    }
                });
            }, { threshold: 0.1, rootMargin: "-40% 0px -40% 0px" });
            imagenes.forEach(img => observer.observe(img));
        }

        function actualizarUI(num) {
            pageDisplay.innerText = num;
            const porcentaje = (num / TOTAL_PAGINAS) * 100;
            dockProgress.style.width = `${porcentaje}%`;
            document.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`btn-${num}`);
            if(btn) btn.classList.add('active');
        }

        let isHidden = false;
        function toggleCinemaMode() {
            const dock = document.getElementById('dock-container');
            isHidden ? dock.classList.remove('hidden') : dock.classList.add('hidden');
            isHidden = !isHidden;
        }

        function abrirSheet() { document.getElementById('sheet-overlay').style.display = 'block'; }
        function cerrarSheet(e) { if(e.target.id === 'sheet-overlay') document.getElementById('sheet-overlay').style.display = 'none'; }
        function irAPagina(num) {
            document.getElementById('sheet-overlay').style.display = 'none';
            const dest = document.getElementById(`img-${num}`);
            if(dest) dest.scrollIntoView({behavior: 'smooth', block: 'start'});
        }
    </script>
</body>
</html>

